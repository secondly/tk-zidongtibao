<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ç‹¬ç«‹å¾ªç¯å®¹å™¨æµ‹è¯•é¡µé¢</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background-color: #f5f5f5;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      h1 {
        color: #333;
        text-align: center;
        margin-bottom: 30px;
      }

      .test-table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
      }

      .test-row {
        border: 1px solid #ddd;
        background: #fff;
        transition: background-color 0.3s;
      }

      .test-row:hover {
        background-color: #f9f9f9;
      }

      .test-row td {
        padding: 15px;
        border-bottom: 1px solid #eee;
        vertical-align: middle;
      }

      .drag-handle {
        display: inline-block;
        padding: 8px 15px;
        background: #e74c3c;
        color: white;
        border-radius: 20px;
        cursor: move;
        font-size: 12px;
        margin-right: 10px;
        user-select: none;
        transition: all 0.3s;
      }

      .drag-handle:hover {
        background: #c0392b;
        transform: scale(1.05);
      }

      .action-button {
        padding: 8px 16px;
        background: #3498db;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.3s;
      }

      .action-button:hover {
        background: #2980b9;
        transform: translateY(-1px);
      }

      .action-button.success {
        background: #27ae60;
      }

      .action-button.success:hover {
        background: #229954;
      }

      .status-display {
        margin: 20px 0;
        padding: 15px;
        background: #ecf0f1;
        border-radius: 4px;
        border-left: 4px solid #3498db;
      }

      .log-area {
        margin: 20px 0;
        padding: 15px;
        background: #2c3e50;
        color: #ecf0f1;
        border-radius: 4px;
        font-family: "Courier New", monospace;
        font-size: 12px;
        max-height: 300px;
        overflow-y: auto;
      }

      .controls {
        margin: 20px 0;
        text-align: center;
      }

      .controls button {
        margin: 0 10px;
        padding: 10px 20px;
        font-size: 16px;
      }

      .item-info {
        font-weight: bold;
        color: #2c3e50;
      }

      .item-description {
        color: #7f8c8d;
        font-size: 14px;
        margin-top: 5px;
      }

      .wait-element {
        display: inline-block;
        padding: 5px 10px;
        background: #f39c12;
        color: white;
        border-radius: 12px;
        font-size: 11px;
        margin-left: 10px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ğŸ§ª ç‹¬ç«‹å¾ªç¯å®¹å™¨æµ‹è¯•é¡µé¢</h1>

      <div class="status-display" id="statusDisplay">
        <strong>çŠ¶æ€ï¼š</strong><span id="statusText">å‡†å¤‡å°±ç»ª</span>
      </div>

      <div class="controls">
        <button class="action-button" onclick="clearLogs()">æ¸…é™¤æ—¥å¿—</button>
        <button class="action-button success" onclick="simulateAutomation()">
          æ¨¡æ‹Ÿè‡ªåŠ¨åŒ–æ‰§è¡Œ
        </button>
        <button
          class="action-button"
          onclick="debugElementSelection()"
          style="background: #9b59b6"
        >
          è°ƒè¯•å…ƒç´ é€‰æ‹©
        </button>
        <button
          class="action-button"
          onclick="testSubOperations()"
          style="background: #e67e22"
        >
          æµ‹è¯•å­æ“ä½œ
        </button>
      </div>

      <table class="test-table">
        <thead>
          <tr style="background: #34495e; color: white">
            <th style="padding: 15px">æ“ä½œåŒºåŸŸ</th>
            <th style="padding: 15px">é¡¹ç›®ä¿¡æ¯</th>
            <th style="padding: 15px">ç­‰å¾…å…ƒç´ </th>
            <th style="padding: 15px">æ“ä½œæŒ‰é’®</th>
          </tr>
        </thead>
        <tbody>
          <tr class="test-row" data-row="1">
            <td>
              <div class="drag-handle" draggable="true" id="drag-item-1">
                ğŸ¯ æ‹–æ‹½1
              </div>
            </td>
            <td>
              <div class="item-info">æµ‹è¯•é¡¹ç›® Alpha</div>
              <div class="item-description">
                è¿™æ˜¯ç¬¬ä¸€ä¸ªæµ‹è¯•é¡¹ç›®ï¼ŒåŒ…å«æ‹–æ‹½å’Œç‚¹å‡»æ“ä½œ
              </div>
            </td>
            <td>
              <span class="wait-element" id="wait-1">â³ ç­‰å¾…ä¸­</span>
            </td>
            <td>
              <button class="action-button" onclick="handleRowAction(1)">
                æ‰§è¡Œæ“ä½œ
              </button>
            </td>
          </tr>
          <tr class="test-row" data-row="2">
            <td>
              <div class="drag-handle" draggable="true" id="drag-item-2">
                ğŸ¯ æ‹–æ‹½2
              </div>
            </td>
            <td>
              <div class="item-info">æµ‹è¯•é¡¹ç›® Beta</div>
              <div class="item-description">
                è¿™æ˜¯ç¬¬äºŒä¸ªæµ‹è¯•é¡¹ç›®ï¼Œæµ‹è¯•å¾ªç¯å®¹å™¨åŠŸèƒ½
              </div>
            </td>
            <td>
              <span class="wait-element" id="wait-2">â³ ç­‰å¾…ä¸­</span>
            </td>
            <td>
              <button class="action-button" onclick="handleRowAction(2)">
                æ‰§è¡Œæ“ä½œ
              </button>
            </td>
          </tr>
          <tr class="test-row" data-row="3">
            <td>
              <div class="drag-handle" draggable="true" id="drag-item-3">
                ğŸ¯ æ‹–æ‹½3
              </div>
            </td>
            <td>
              <div class="item-info">æµ‹è¯•é¡¹ç›® Gamma</div>
              <div class="item-description">
                è¿™æ˜¯ç¬¬ä¸‰ä¸ªæµ‹è¯•é¡¹ç›®ï¼ŒéªŒè¯è‡ªåŠ¨åŒ–æµç¨‹
              </div>
            </td>
            <td>
              <span class="wait-element" id="wait-3">â³ ç­‰å¾…ä¸­</span>
            </td>
            <td>
              <button class="action-button" onclick="handleRowAction(3)">
                æ‰§è¡Œæ“ä½œ
              </button>
            </td>
          </tr>
          <tr class="test-row" data-row="4">
            <td>
              <div class="drag-handle" draggable="true" id="drag-item-4">
                ğŸ¯ æ‹–æ‹½4
              </div>
            </td>
            <td>
              <div class="item-info">æµ‹è¯•é¡¹ç›® Delta</div>
              <div class="item-description">
                è¿™æ˜¯ç¬¬å››ä¸ªæµ‹è¯•é¡¹ç›®ï¼Œæµ‹è¯•å¤æ‚æ“ä½œåºåˆ—
              </div>
            </td>
            <td>
              <span class="wait-element" id="wait-4">â³ ç­‰å¾…ä¸­</span>
            </td>
            <td>
              <button class="action-button" onclick="handleRowAction(4)">
                æ‰§è¡Œæ“ä½œ
              </button>
            </td>
          </tr>
          <tr class="test-row" data-row="5">
            <td>
              <div class="drag-handle" draggable="true" id="drag-item-5">
                ğŸ¯ æ‹–æ‹½5
              </div>
            </td>
            <td>
              <div class="item-info">æµ‹è¯•é¡¹ç›® Epsilon</div>
              <div class="item-description">
                è¿™æ˜¯ç¬¬äº”ä¸ªæµ‹è¯•é¡¹ç›®ï¼Œæœ€ç»ˆéªŒè¯æµ‹è¯•
              </div>
            </td>
            <td>
              <span class="wait-element" id="wait-5">â³ ç­‰å¾…ä¸­</span>
            </td>
            <td>
              <button class="action-button" onclick="handleRowAction(5)">
                æ‰§è¡Œæ“ä½œ
              </button>
            </td>
          </tr>
        </tbody>
      </table>

      <div class="log-area" id="logArea">
        <div>ğŸ“‹ æ“ä½œæ—¥å¿—ï¼š</div>
      </div>
    </div>

    <script>
      // æ—¥å¿—åŠŸèƒ½
      function addLog(message, type = "info") {
        const logArea = document.getElementById("logArea");
        const timestamp = new Date().toLocaleTimeString();
        const prefix =
          {
            info: "â„¹ï¸",
            success: "âœ…",
            warning: "âš ï¸",
            error: "âŒ",
            drag: "ğŸ–±ï¸",
            click: "ğŸ‘†",
          }[type] || "â„¹ï¸";

        const logEntry = document.createElement("div");
        logEntry.innerHTML = `[${timestamp}] ${prefix} ${message}`;
        logArea.appendChild(logEntry);
        logArea.scrollTop = logArea.scrollHeight;
      }

      function clearLogs() {
        const logArea = document.getElementById("logArea");
        logArea.innerHTML = "<div>ğŸ“‹ æ“ä½œæ—¥å¿—ï¼š</div>";
      }

      function updateStatus(message, type = "info") {
        const statusText = document.getElementById("statusText");
        statusText.textContent = message;
        addLog(message, type);
      }

      // è¡Œæ“ä½œå¤„ç†
      function handleRowAction(rowNumber) {
        updateStatus(`æ‰§è¡Œç¬¬ ${rowNumber} è¡Œæ“ä½œ`, "click");

        // æ¨¡æ‹Ÿæ“ä½œå»¶è¿Ÿ
        setTimeout(() => {
          updateStatus(`ç¬¬ ${rowNumber} è¡Œæ“ä½œå®Œæˆ`, "success");
        }, 500);
      }

      // æ‹–æ‹½åŠŸèƒ½
      document.querySelectorAll(".drag-handle").forEach((handle) => {
        handle.addEventListener("dragstart", function (e) {
          const id = this.id;
          addLog(`å¼€å§‹æ‹–æ‹½: ${id}`, "drag");
          e.dataTransfer.setData("text/plain", id);
          this.style.opacity = "0.5";
        });

        handle.addEventListener("dragend", function (e) {
          const id = this.id;
          addLog(`æ‹–æ‹½ç»“æŸ: ${id}`, "drag");
          this.style.opacity = "1";
        });
      });

      // æ¨¡æ‹Ÿè‡ªåŠ¨åŒ–æ‰§è¡Œ
      async function simulateAutomation() {
        updateStatus("å¼€å§‹æ¨¡æ‹Ÿè‡ªåŠ¨åŒ–æ‰§è¡Œ...", "info");

        const rows = document.querySelectorAll(".test-row");

        for (let i = 0; i < rows.length; i++) {
          const row = rows[i];
          const rowNumber = i + 1;

          updateStatus(`å¤„ç†ç¬¬ ${rowNumber} è¡Œå®¹å™¨`, "info");

          // é«˜äº®å½“å‰è¡Œ
          row.style.background = "#e8f4fd";
          row.style.border = "2px solid #3498db";

          // 1. æ¨¡æ‹Ÿæ‹–æ‹½æ“ä½œ
          const dragHandle = row.querySelector(".drag-handle");
          if (dragHandle) {
            addLog(`æ‰§è¡Œæ‹–æ‹½æ“ä½œ: ${dragHandle.id}`, "drag");

            // è§†è§‰æ•ˆæœ
            dragHandle.style.transform = "translate(50px, 20px)";
            dragHandle.style.background = "#e74c3c";

            await new Promise((resolve) => setTimeout(resolve, 1000));

            // æ¢å¤ä½ç½®
            dragHandle.style.transform = "";
            dragHandle.style.background = "#e74c3c";

            addLog(`æ‹–æ‹½å®Œæˆ: ${dragHandle.id}`, "success");
          }

          // 2. æ¨¡æ‹Ÿç­‰å¾…æ“ä½œ
          const waitElement = row.querySelector(".wait-element");
          if (waitElement) {
            addLog(`æ™ºèƒ½ç­‰å¾…: wait-${rowNumber}`, "warning");
            waitElement.style.background = "#f39c12";
            waitElement.textContent = "â³ ç­‰å¾…ä¸­...";

            await new Promise((resolve) => setTimeout(resolve, 800));

            waitElement.style.background = "#27ae60";
            waitElement.textContent = "âœ… å®Œæˆ";
            addLog(`ç­‰å¾…å®Œæˆ: wait-${rowNumber}`, "success");
          }

          // 3. æ¨¡æ‹Ÿç‚¹å‡»æ“ä½œ
          const button = row.querySelector(".action-button");
          if (button) {
            addLog(`æ‰§è¡Œç‚¹å‡»æ“ä½œ: ç¬¬${rowNumber}è¡ŒæŒ‰é’®`, "click");

            // è§†è§‰æ•ˆæœ
            button.style.background = "#27ae60";
            button.style.transform = "scale(0.95)";

            await new Promise((resolve) => setTimeout(resolve, 500));

            button.style.background = "#3498db";
            button.style.transform = "";

            addLog(`ç‚¹å‡»å®Œæˆ: ç¬¬${rowNumber}è¡ŒæŒ‰é’®`, "success");
          }

          // æ¢å¤è¡Œæ ·å¼
          row.style.background = "";
          row.style.border = "1px solid #ddd";

          updateStatus(`ç¬¬ ${rowNumber} è¡Œå¤„ç†å®Œæˆ`, "success");

          // ç­‰å¾…ä¸€ä¸‹å†å¤„ç†ä¸‹ä¸€è¡Œ
          await new Promise((resolve) => setTimeout(resolve, 1000));
        }

        updateStatus("æ‰€æœ‰å¾ªç¯å®¹å™¨æ“ä½œå®Œæˆï¼", "success");
      }

      // è°ƒè¯•å…ƒç´ é€‰æ‹©
      function debugElementSelection() {
        addLog("å¼€å§‹è°ƒè¯•å…ƒç´ é€‰æ‹©...", "info");

        // æµ‹è¯•å¾ªç¯å®¹å™¨é€‰æ‹©å™¨
        const containers = document.querySelectorAll(".test-row");
        addLog(`æ‰¾åˆ° ${containers.length} ä¸ªå¾ªç¯å®¹å™¨ (.test-row)`, "info");

        containers.forEach((container, index) => {
          addLog(
            `å®¹å™¨ ${index + 1}: ${container.tagName}.${container.className}`,
            "info"
          );

          // æµ‹è¯•å­å…ƒç´ é€‰æ‹©
          const dragHandle = container.querySelector(".drag-handle");
          const waitElement = container.querySelector(".wait-element");
          const button = container.querySelector(".action-button");

          addLog(
            `  - æ‹–æ‹½å…ƒç´ : ${dragHandle ? dragHandle.id : "æœªæ‰¾åˆ°"}`,
            dragHandle ? "success" : "error"
          );
          addLog(
            `  - ç­‰å¾…å…ƒç´ : ${waitElement ? waitElement.id : "æœªæ‰¾åˆ°"}`,
            waitElement ? "success" : "error"
          );
          addLog(
            `  - æŒ‰é’®å…ƒç´ : ${button ? "æ‰¾åˆ°" : "æœªæ‰¾åˆ°"}`,
            button ? "success" : "error"
          );
        });
      }

      // æµ‹è¯•å­æ“ä½œåºåˆ—
      async function testSubOperations() {
        addLog("å¼€å§‹æµ‹è¯•å­æ“ä½œåºåˆ—...", "info");

        const containers = document.querySelectorAll(".test-row");

        for (let i = 0; i < Math.min(2, containers.length); i++) {
          const container = containers[i];
          const rowNumber = i + 1;

          addLog(`æµ‹è¯•å®¹å™¨ ${rowNumber} çš„å­æ“ä½œ`, "info");

          // é«˜äº®å®¹å™¨
          container.style.background = "#fff3cd";
          container.style.border = "2px solid #ffc107";

          try {
            // 1. æµ‹è¯•æ‹–æ‹½å­æ“ä½œ
            const dragHandle = container.querySelector(".drag-handle");
            if (dragHandle) {
              addLog(`æ‰§è¡Œæ‹–æ‹½å­æ“ä½œ: ${dragHandle.id}`, "drag");

              // æ¨¡æ‹Ÿæ‹–æ‹½
              dragHandle.style.border = "3px solid #ff6b6b";
              dragHandle.style.transform = "translate(80px, 25px)";

              await new Promise((resolve) => setTimeout(resolve, 1000));

              dragHandle.style.transform = "";
              dragHandle.style.border = "";

              addLog(`æ‹–æ‹½å­æ“ä½œå®Œæˆ: ${dragHandle.id}`, "success");
            } else {
              addLog(`æ‹–æ‹½å…ƒç´ æœªæ‰¾åˆ°`, "error");
            }

            // 2. æµ‹è¯•ç­‰å¾…å­æ“ä½œ
            const waitElement = container.querySelector(".wait-element");
            if (waitElement) {
              addLog(`æ‰§è¡Œç­‰å¾…å­æ“ä½œ: ${waitElement.id}`, "warning");

              waitElement.style.background = "#f39c12";
              waitElement.textContent = "â³ ç­‰å¾…ä¸­...";

              await new Promise((resolve) => setTimeout(resolve, 800));

              waitElement.style.background = "#27ae60";
              waitElement.textContent = "âœ… ç­‰å¾…å®Œæˆ";

              addLog(`ç­‰å¾…å­æ“ä½œå®Œæˆ: ${waitElement.id}`, "success");
            } else {
              addLog(`ç­‰å¾…å…ƒç´ æœªæ‰¾åˆ°`, "error");
            }

            // 3. æµ‹è¯•ç‚¹å‡»å­æ“ä½œ
            const button = container.querySelector(".action-button");
            if (button) {
              addLog(`æ‰§è¡Œç‚¹å‡»å­æ“ä½œ: æŒ‰é’®`, "click");

              button.style.background = "#27ae60";
              button.style.border = "2px solid #229954";

              await new Promise((resolve) => setTimeout(resolve, 500));

              button.style.background = "#3498db";
              button.style.border = "";

              addLog(`ç‚¹å‡»å­æ“ä½œå®Œæˆ: æŒ‰é’®`, "success");
            } else {
              addLog(`æŒ‰é’®å…ƒç´ æœªæ‰¾åˆ°`, "error");
            }

            addLog(`å®¹å™¨ ${rowNumber} æ‰€æœ‰å­æ“ä½œå®Œæˆ`, "success");
          } catch (error) {
            addLog(`å®¹å™¨ ${rowNumber} å­æ“ä½œå¤±è´¥: ${error.message}`, "error");
          }

          // æ¢å¤å®¹å™¨æ ·å¼
          container.style.background = "";
          container.style.border = "1px solid #ddd";

          // ç­‰å¾…ä¸€ä¸‹å†å¤„ç†ä¸‹ä¸€ä¸ª
          await new Promise((resolve) => setTimeout(resolve, 1500));
        }

        addLog("å­æ“ä½œåºåˆ—æµ‹è¯•å®Œæˆ", "success");
      }

      // é¡µé¢åŠ è½½å®Œæˆ
      document.addEventListener("DOMContentLoaded", function () {
        addLog("ç‹¬ç«‹æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ", "success");
        updateStatus("é¡µé¢å·²å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥å¼€å§‹æµ‹è¯•", "info");

        // æ˜¾ç¤ºæµ‹è¯•é…ç½®ä¿¡æ¯
        addLog("æµ‹è¯•é…ç½®ä¿¡æ¯:", "info");
        addLog("- å¾ªç¯å®¹å™¨é€‰æ‹©å™¨: .test-row", "info");
        addLog("- æ‹–æ‹½å…ƒç´ é€‰æ‹©å™¨: .drag-handle", "info");
        addLog("- ç­‰å¾…å…ƒç´ é€‰æ‹©å™¨: .wait-element", "info");
        addLog("- æŒ‰é’®å…ƒç´ é€‰æ‹©å™¨: .action-button", "info");
      });
    </script>
  </body>
</html>
