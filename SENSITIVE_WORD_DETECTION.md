# 敏感词检测功能使用指南

## 功能概述

敏感词检测功能是为循环操作容器添加的智能过滤功能，可以在执行循环操作时自动跳过包含指定敏感词的元素，避免对不需要的内容进行操作。

## 功能特点

- ✅ 支持多个敏感词，用英文逗号分隔
- ✅ 不区分大小写的敏感词匹配
- ✅ 灵活的定位策略，可以检测元素的任意子元素
- ✅ 实时测试功能，方便调试和验证
- ✅ 可视化高亮显示，清楚展示检测结果
- ✅ 模块化设计，不影响其他功能

## 使用步骤

### 1. 创建循环操作容器

1. 在工作流设计器中添加"循环操作容器"节点
2. 配置基本的循环选择器（如：`.list-item`、`.product-card` 等）

### 2. 启用敏感词检测

1. 在循环操作容器的属性面板中找到"敏感词检测"选项
2. 勾选"敏感词检测"复选框启用功能

### 3. 配置敏感词列表

在"敏感词列表"文本框中输入要过滤的敏感词，每个敏感词用英文逗号分隔：

```
广告,推广,营销,spam,advertisement,promotion
```

### 4. 配置检测定位

- **敏感词检测定位策略**：选择如何定位要检测的文本元素
  - CSS选择器：如 `.content`、`.title`、`p`
  - XPath：如 `//div[@class='content']`
  - ID：如 `content-text`
  - 类名：如 `content-text`
  - 标签名：如 `p`、`span`、`div`

- **敏感词检测定位值**：具体的定位值
  - 如果留空，则检测整个循环元素的文本内容
  - 如果指定值，则只检测循环元素内匹配的子元素

### 5. 测试功能

点击"🔍 测试检测"按钮可以：
- 验证敏感词检测配置是否正确
- 查看有多少元素会被跳过
- 通过高亮显示直观地看到检测结果

## 配置示例

### 示例1：检测整个列表项

```
循环选择器：.list-item
敏感词列表：广告,推广,营销
敏感词检测定位策略：CSS选择器
敏感词检测定位值：（留空）
```

这将检测每个 `.list-item` 元素的完整文本内容。

### 示例2：只检测标题部分

```
循环选择器：.product-card
敏感词列表：spam,advertisement,promotion
敏感词检测定位策略：CSS选择器
敏感词检测定位值：.product-title
```

这将只检测每个 `.product-card` 内的 `.product-title` 元素的文本。

### 示例3：检测特定属性

```
循环选择器：.news-item
敏感词列表：假新闻,虚假,谣言
敏感词检测定位策略：CSS选择器
敏感词检测定位值：.news-content
```

这将检测每个 `.news-item` 内的 `.news-content` 元素的文本内容。

## 执行效果

当启用敏感词检测后，循环执行时会：

1. **检测阶段**：对每个循环元素进行敏感词检测
2. **跳过处理**：如果检测到敏感词，跳过当前元素的所有子操作
3. **继续循环**：直接进入下一个循环元素
4. **日志记录**：在控制台输出详细的检测和跳过信息

## 测试页面

项目中包含了一个测试页面 `sensitive-word-test.html`，可以用来验证敏感词检测功能：

1. 在浏览器中打开 `sensitive-word-test.html`
2. 按照页面上的说明配置循环操作容器
3. 使用测试功能验证敏感词检测是否正常工作

## 技术实现

### 模块结构

- `modules/content/sensitive-word-detector.js`：敏感词检测核心模块
- `modules/designer/designer-nodes.js`：设计器界面集成
- `modules/content/content-automation.js`：执行逻辑集成

### 检测流程

1. 解析敏感词列表（逗号分隔）
2. 根据定位策略找到目标文本元素
3. 提取文本内容（使用 `innerText`）
4. 进行不区分大小写的包含匹配
5. 返回检测结果和匹配的敏感词

### 高亮显示

- 🔵 蓝色：正在处理的元素
- 🟢 绿色：通过检测的元素
- 🔴 红色：检测出错的元素
- ⚪ 灰色：包含敏感词被跳过的元素

## 注意事项

1. **性能考虑**：敏感词检测会增加循环执行时间，建议合理配置敏感词数量
2. **文本匹配**：目前使用简单的包含匹配，不支持正则表达式
3. **错误处理**：如果敏感词检测失败，默认不跳过元素，确保流程正常执行
4. **兼容性**：敏感词检测功能向后兼容，不会影响现有的循环操作配置

## 故障排除

### 常见问题

1. **敏感词检测不生效**
   - 检查是否勾选了"敏感词检测"复选框
   - 确认敏感词列表格式正确（英文逗号分隔）
   - 验证循环选择器是否能找到元素

2. **检测结果不准确**
   - 检查敏感词检测定位配置是否正确
   - 使用测试功能验证定位是否准确
   - 查看浏览器控制台的详细日志

3. **测试按钮无响应**
   - 确保在正确的页面上进行测试
   - 检查浏览器控制台是否有错误信息
   - 尝试刷新页面重新配置

### 调试技巧

1. 使用浏览器开发者工具查看控制台日志
2. 利用测试功能验证配置正确性
3. 观察高亮显示效果判断检测结果
4. 逐步调整敏感词列表和定位配置

## 更新日志

### v1.0.0
- 初始版本发布
- 支持基本的敏感词检测功能
- 集成到循环操作容器
- 提供测试和调试功能