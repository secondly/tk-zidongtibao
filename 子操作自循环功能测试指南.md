# 子操作自循环功能测试指南

## 🎯 功能概述

现在已经成功在子操作配置界面中添加了"自循环"功能，可以解决 `.selection-item` 多元素点击的问题。

## 🔧 新增功能特性

### 1. 子操作类型选择器
- 在子操作编辑模态框中新增"自循环"选项
- 选择"自循环"后会显示专门的配置界面

### 2. 自循环配置选项
- **定位策略**：CSS选择器、XPath、ID、类名
- **定位值**：用于找到所有匹配元素的选择器
- **循环操作类型**：点击、输入文本、勾选复选框、取消勾选、悬停、聚焦
- **输入文本**：当操作类型为"输入文本"时使用
- **起始索引**：从第几个元素开始处理（从0开始计数）
- **结束索引**：处理到第几个元素结束，-1表示处理所有元素
- **操作间隔**：每次操作之间的等待时间（毫秒）
- **错误处理**：继续执行或停止执行

### 3. 执行逻辑
- 找到所有匹配定位值的元素
- 按照配置的索引范围依次执行操作
- 等待所有元素处理完毕后才继续下一个子操作
- 支持错误处理策略

## 📋 测试步骤

### 第一步：配置父级循环
1. 创建新的工作流
2. 添加"循环"操作步骤
3. 选择"父级循环（带子操作）"
4. 配置主循环定位值：`.test-btn`

### 第二步：添加子操作
1. 在父级循环配置中，点击"添加子操作"
2. 选择操作类型："自循环"
3. 配置如下：
   - **定位策略**：CSS选择器
   - **定位值**：`.selection-item`
   - **循环操作类型**：点击
   - **起始索引**：0
   - **结束索引**：-1（处理所有元素）
   - **操作间隔**：200毫秒
   - **错误处理**：继续执行

### 第三步：保存并测试
1. 保存子操作配置
2. 保存父级循环配置
3. 执行工作流
4. 观察是否所有 `.selection-item` 元素都被点击

## ✅ 预期结果

### 正确执行时应该看到：
1. ✅ 找到所有 `.selection-item` 元素（应该有10个）
2. ✅ 依次点击每一个 `.selection-item` 元素
3. ✅ 每次点击间隔200毫秒
4. ✅ 所有元素点击完成后继续执行下一个子操作
5. ✅ 控制台显示详细的执行日志

### 控制台日志示例：
```
🔁 子操作-自循环开始: .selection-item
🔍 在父级元素内找到 10 个目标
📊 自循环找到 10 个元素，处理范围: 0 - 9
🎯 自循环处理第 1/10 个元素
✅ 第 1 个元素click操作完成
🎯 自循环处理第 2/10 个元素
✅ 第 2 个元素click操作完成
...
🎉 自循环执行完成: 成功 10 个，失败 0 个
```

## 🔄 应用场景

### 解决 .selection-item 问题
现在用户可以在父级循环的子操作中配置自循环来处理多元素点击需求：

```
父级循环配置：
├── 主循环定位值：.test-btn
├── 子操作序列：
│   ├── 1. 等待操作：等待 .selection-list 加载
│   ├── 2. 自循环：点击所有 .selection-item  ← 新功能
│   └── 3. 点击操作：点击确认按钮
└── 循环间隔：1000毫秒
```

### 其他应用场景
- 批量勾选复选框
- 批量填写表单字段
- 批量悬停元素触发效果
- 批量聚焦输入框

## 🚨 注意事项

1. **索引范围**：起始索引从0开始计数，结束索引-1表示处理所有元素
2. **操作间隔**：建议设置200-500毫秒的间隔，避免操作过快
3. **错误处理**：建议选择"继续执行"，避免单个元素失败导致整个流程停止
4. **定位器准确性**：确保定位值能准确找到目标元素
5. **父级元素上下文**：自循环会优先在父级元素内查找，找不到时才全局查找

## 🔍 调试技巧

1. **查看控制台日志**：详细的执行日志可以帮助定位问题
2. **测试定位器**：先用浏览器开发者工具验证选择器是否正确
3. **调整索引范围**：如果只想处理部分元素，可以设置具体的起始和结束索引
4. **增加操作间隔**：如果页面响应较慢，可以增加操作间隔时间

## 🎉 功能优势

1. **无需单独步骤**：直接在子操作中配置，不需要额外的主要操作步骤
2. **灵活配置**：支持多种操作类型和索引范围设置
3. **错误容错**：支持错误处理策略，提高执行稳定性
4. **上下文感知**：优先在父级元素内查找，提高定位准确性
5. **详细日志**：提供完整的执行日志，便于调试和监控
