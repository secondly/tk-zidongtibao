<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>选择器测试工具</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-input {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: monospace;
        }
        .test-button {
            background: #1890ff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #40a9ff;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .success {
            background: #f6ffed;
            border: 1px solid #b7eb8f;
            color: #52c41a;
        }
        .error {
            background: #fff2f0;
            border: 1px solid #ffccc7;
            color: #ff4d4f;
        }
        .info {
            background: #e6f7ff;
            border: 1px solid #91d5ff;
            color: #1890ff;
        }
        .selector-list {
            background: #fafafa;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .selector-item {
            margin: 5px 0;
            padding: 5px;
            background: white;
            border-radius: 3px;
            cursor: pointer;
            border: 1px solid #ddd;
        }
        .selector-item:hover {
            background: #e6f7ff;
            border-color: #1890ff;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔍 选择器测试工具</h1>
        <p>这个工具帮助您测试和验证CSS选择器，确保工作流能正确找到元素。</p>

        <div class="test-section">
            <h3>📋 常用复选框选择器</h3>
            <div class="selector-list">
                <div class="selector-item" onclick="testSelector('input[type=checkbox]')">
                    input[type=checkbox] - 所有复选框
                </div>
                <div class="selector-item" onclick="testSelector('input[type=checkbox]:not(:checked)')">
                    input[type=checkbox]:not(:checked) - 未勾选的复选框
                </div>
                <div class="selector-item" onclick="testSelector('input[type=checkbox]:not(:disabled)')">
                    input[type=checkbox]:not(:disabled) - 可用的复选框
                </div>
                <div class="selector-item" onclick="testSelector('.modal input[type=checkbox]')">
                    .modal input[type=checkbox] - 弹窗中的复选框
                </div>
                <div class="selector-item" onclick="testSelector('[role=dialog] input[type=checkbox]')">
                    [role=dialog] input[type=checkbox] - 对话框中的复选框
                </div>
                <div class="selector-item" onclick="testSelector('table input[type=checkbox]')">
                    table input[type=checkbox] - 表格中的复选框
                </div>
            </div>
        </div>

        <div class="test-section">
            <h3>🧪 自定义选择器测试</h3>
            <input type="text" id="customSelector" class="test-input" 
                   placeholder="输入CSS选择器，例如: input[type=checkbox]" 
                   value="input[type=checkbox]">
            <button class="test-button" onclick="testCustomSelector()">测试选择器</button>
            <button class="test-button" onclick="highlightElements()">高亮显示</button>
            <button class="test-button" onclick="clearHighlight()">清除高亮</button>
        </div>

        <div class="test-section">
            <h3>📊 测试结果</h3>
            <div id="testResult" class="result info">点击上方按钮开始测试...</div>
        </div>

        <div class="test-section">
            <h3>🎯 页面元素分析</h3>
            <button class="test-button" onclick="analyzeCheckboxes()">分析页面复选框</button>
            <button class="test-button" onclick="analyzeModals()">分析弹窗元素</button>
            <button class="test-button" onclick="analyzeButtons()">分析按钮元素</button>
            <div id="analysisResult" class="result info">点击分析按钮查看页面元素...</div>
        </div>

        <div class="test-section">
            <h3>🔧 工作流配置生成</h3>
            <button class="test-button" onclick="generateConfig()">生成勾选配置</button>
            <div id="configResult" class="result info">点击生成按钮获取配置...</div>
        </div>
    </div>

    <script>
        function testSelector(selector) {
            document.getElementById('customSelector').value = selector;
            testCustomSelector();
        }

        function testCustomSelector() {
            const selector = document.getElementById('customSelector').value;
            const resultDiv = document.getElementById('testResult');
            
            try {
                const elements = document.querySelectorAll(selector);
                
                if (elements.length === 0) {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `❌ 未找到匹配的元素\n选择器: ${selector}`;
                } else {
                    resultDiv.className = 'result success';
                    let result = `✅ 找到 ${elements.length} 个元素\n选择器: ${selector}\n\n元素详情:\n`;
                    
                    elements.forEach((el, index) => {
                        result += `${index + 1}. ${el.tagName.toLowerCase()}`;
                        if (el.id) result += `#${el.id}`;
                        if (el.className) result += `.${el.className.split(' ').join('.')}`;
                        if (el.type) result += ` [type="${el.type}"]`;
                        if (el.checked !== undefined) result += ` [checked=${el.checked}]`;
                        result += '\n';
                    });
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `❌ 选择器语法错误\n${error.message}`;
            }
        }

        function highlightElements() {
            clearHighlight();
            const selector = document.getElementById('customSelector').value;
            
            try {
                const elements = document.querySelectorAll(selector);
                elements.forEach(el => {
                    el.style.outline = '3px solid #ff4d4f';
                    el.style.backgroundColor = 'rgba(255, 77, 79, 0.1)';
                });
                
                if (elements.length > 0) {
                    elements[0].scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            } catch (error) {
                console.error('高亮失败:', error);
            }
        }

        function clearHighlight() {
            const allElements = document.querySelectorAll('*');
            allElements.forEach(el => {
                el.style.outline = '';
                el.style.backgroundColor = '';
            });
        }

        function analyzeCheckboxes() {
            const checkboxes = document.querySelectorAll('input[type=checkbox]');
            const resultDiv = document.getElementById('analysisResult');
            
            if (checkboxes.length === 0) {
                resultDiv.className = 'result error';
                resultDiv.textContent = '❌ 页面中没有找到复选框元素';
                return;
            }
            
            resultDiv.className = 'result info';
            let result = `📋 找到 ${checkboxes.length} 个复选框:\n\n`;
            
            checkboxes.forEach((checkbox, index) => {
                result += `${index + 1}. `;
                
                // 生成选择器
                let selectors = [];
                if (checkbox.id) selectors.push(`#${checkbox.id}`);
                if (checkbox.name) selectors.push(`[name="${checkbox.name}"]`);
                if (checkbox.className) selectors.push(`.${checkbox.className.split(' ').join('.')}`);
                
                // 父元素信息
                let parent = checkbox.parentElement;
                let parentInfo = '';
                if (parent) {
                    if (parent.className) parentInfo += ` 父元素: .${parent.className.split(' ').join('.')}`;
                }
                
                result += `${selectors.join(' 或 ')} [checked=${checkbox.checked}]${parentInfo}\n`;
            });
            
            result += '\n推荐选择器:\n';
            result += '• input[type=checkbox] - 所有复选框\n';
            result += '• input[type=checkbox]:not(:checked) - 未勾选的复选框\n';
            
            resultDiv.textContent = result;
        }

        function analyzeModals() {
            const modals = document.querySelectorAll('.modal, [role=dialog], .dialog, .popup, [class*=modal], [class*=dialog]');
            const resultDiv = document.getElementById('analysisResult');
            
            resultDiv.className = 'result info';
            let result = `🪟 找到 ${modals.length} 个弹窗/对话框:\n\n`;
            
            modals.forEach((modal, index) => {
                result += `${index + 1}. `;
                if (modal.id) result += `#${modal.id} `;
                if (modal.className) result += `.${modal.className.split(' ').join('.')} `;
                
                const checkboxes = modal.querySelectorAll('input[type=checkbox]');
                result += `(包含 ${checkboxes.length} 个复选框)\n`;
            });
            
            resultDiv.textContent = result;
        }

        function analyzeButtons() {
            const buttons = document.querySelectorAll('button, input[type=button], input[type=submit], [role=button]');
            const resultDiv = document.getElementById('analysisResult');
            
            resultDiv.className = 'result info';
            let result = `🔘 找到 ${buttons.length} 个按钮:\n\n`;
            
            buttons.forEach((button, index) => {
                if (index < 10) { // 只显示前10个
                    result += `${index + 1}. "${button.textContent.trim() || button.value || '无文本'}" `;
                    if (button.id) result += `#${button.id} `;
                    if (button.className) result += `.${button.className.split(' ').join('.')}`;
                    result += '\n';
                }
            });
            
            if (buttons.length > 10) {
                result += `... 还有 ${buttons.length - 10} 个按钮\n`;
            }
            
            resultDiv.textContent = result;
        }

        function generateConfig() {
            const checkboxes = document.querySelectorAll('input[type=checkbox]');
            const resultDiv = document.getElementById('configResult');
            
            if (checkboxes.length === 0) {
                resultDiv.className = 'result error';
                resultDiv.textContent = '❌ 页面中没有复选框，无法生成配置';
                return;
            }
            
            resultDiv.className = 'result success';
            
            const config = {
                "type": "loop",
                "name": "勾选商品",
                "loopType": "self",
                "locator": {
                    "strategy": "css",
                    "value": "input[type='checkbox']:not(:checked)"
                },
                "loopSelector": "input[type='checkbox']:not(:checked)",
                "maxIterations": 10,
                "startIndex": 0,
                "endIndex": 3,
                "operationType": "click",
                "operationDelay": 1000
            };
            
            resultDiv.textContent = `✅ 生成的工作流配置:\n\n${JSON.stringify(config, null, 2)}\n\n💡 这个配置会勾选前3个未选中的复选框`;
        }

        // 页面加载完成后自动分析
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🔍 选择器测试工具已加载');
            console.log('💡 使用说明:');
            console.log('1. 点击常用选择器进行快速测试');
            console.log('2. 输入自定义选择器进行测试');
            console.log('3. 使用高亮功能查看选中的元素');
            console.log('4. 分析页面元素了解结构');
            console.log('5. 生成工作流配置');
        });
    </script>
</body>
</html>
